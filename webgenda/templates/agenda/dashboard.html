{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Dashboard</h1>
    <div class="filter-dropdown">
        <button class="filter-button">
            {% if current_filter == 'last_7_days' %}Últimos 7 Dias
            {% elif current_filter == 'last_14_days' %}Últimos 14 Dias
            {% elif current_filter == 'last_month' %}Último Mês
            {% elif current_filter == 'last_year' %}Último Ano
            {% else %}Todo o Período
            {% endif %}
            <i class="bi bi-chevron-down"></i>
        </button>
        <div class="filter-menu">
            <a href="{% url 'dashboard' %}?filter=all_time">Todo o Período</a>
            <a href="{% url 'dashboard' %}?filter=last_7_days">Últimos 7 Dias</a>
            <a href="{% url 'dashboard' %}?filter=last_14_days">Últimos 14 Dias</a>
            <a href="{% url 'dashboard' %}?filter=last_month">Último Mês</a>
            <a href="{% url 'dashboard' %}?filter=last_year">Último Ano</a>
        </div>
    </div>
</div>

<div class="insights-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
    <div class="insight-card">
        <h2>{{ eventos_count }}</h2>
        <p>Eventos na Agenda</p>
    </div>
    <div class="insight-card">
        <h2>{{ total_count }}</h2>
        <p>Total de Atividades</p>
    </div>
</div>

<div class="dashboard-grid">
    <div class="dashboard-card">
        <h3><i class="bi bi-pie-chart-fill"></i> Distribuição de Atividades</h3>
        <div class="chart-container">
            <canvas id="activityChart"></canvas>
        </div>
    </div>
    
    <div class="dashboard-card">
        <h3><i class="bi bi-clock-history"></i> Atividades Recentes</h3>
        <ul class="event-list">
            {% for atividade in atividades_recentes %}
                <li class="event-item">
                    <span class="event-date">{{ atividade.data_inicio|date:"d/m" }}</span>
                    <span class="event-title">{{ atividade.titulo }}</span>
                </li>
            {% empty %}
                <li class="event-item-empty">Nenhuma atividade recente encontrada.</li>
            {% endfor %}
        </ul>
    </div>
    
    <div class="dashboard-card">
        <h3><i class="bi bi-calendar-event"></i> Próximos Eventos</h3>
        </div>
    <div class="dashboard-card">
        <h3><i class="bi bi-lightning-fill"></i> Acessos Rápidos</h3>
        </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('activityChart');
        if (ctx) {
            // Pega os dados JSON do contexto do Django
            const chartData = JSON.parse('{{ chart_data|safe }}');

            new Chart(ctx, {
                type: 'pie', // Tipo do gráfico
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Nº de Atividades',
                        data: chartData.data,
                        backgroundColor: [ // Cores para cada fatia
                            '#f3e8ff', // Roxo (Pesquisa)
                            '#e6f9f0', // Verde (Ensino)
                            '#fff4e6', // Laranja (Extensão)
                            '#e0f7fa'  // Ciano (Administração)
                        ],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }
    });
</script>
{% endblock %}